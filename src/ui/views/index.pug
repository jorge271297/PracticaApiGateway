doctype html
html(lang="es")
  head
    meta(charset="UTF-8")
    title Demo API Gateway UI
    style.
      body { font-family: Arial, sans-serif; margin: 2em; background: #f7f7f7; }
      .container { background: #fff; padding: 2em; border-radius: 8px; max-width: 700px; margin: auto; box-shadow: 0 2px 8px #0001; }
      label { display: block; margin-top: 1em; }
      input, select, button { margin-top: 0.5em; width: 100%; padding: 0.5em; border-radius: 4px; border: 1px solid #ccc; }
      .result { background: #eafaf1; border: 1px solid #b2dfdb; margin-top: 1em; padding: 1em; border-radius: 4px; }
      .productos { max-height: 200px; overflow-y: auto; margin-bottom: 1em; }
      .productos ul { padding-left: 1em; }
      nav { margin-bottom: 1em; }
      nav a { margin-right: 1em; text-decoration: none; color: #1976d2; }
      nav a.active { font-weight: bold; color: #2c3e50; }
  body
    .container
      nav
        a(href="/" class=(view=='home' ? 'active' : '')) Inicio
        a(href="/registro" class=(view=='registro' ? 'active' : '')) Registro
        if login
          a(href="/perfil" class=(view=='perfil' ? 'active' : '')) Perfil
          a(href="/productos" class=(view=='productos' ? 'active' : '')) Productos
          a(href="/carrito" class=(view=='carrito' ? 'active' : '')) Carrito
      if error
        .result(style="background:#ffeaea;border:1px solid #e57373;")= error
      if view=='home'
        if !login
          form(action="/login" method="post")
            label Email:
              input(type="email" name="email" value="" required)
            label Contraseña:
              input(type="password" name="password" value="123456" required)
            button(type="submit") Iniciar sesión
        else
          .result Login exitoso. Usa la navegación para explorar.
      if view=='registro'
        form(action="/registro" method="post")
          label Nombre:
            input(type="text" name="nombre" required)
          label Email:
            input(type="email" name="email" required)
          label Contraseña:
            input(type="password" name="password" required)
          button(type="submit") Registrarse
        if registro
          .result= registro.message || JSON.stringify(registro)
      if view=='perfil' && perfil
        h2 Perfil de usuario
        p
          b> Nombre: 
          | #{perfil.nombre}
        p
          b> Email: 
          | #{perfil.email}
      if view=='productos' && productos
        h2 Lista de productos
        .productos
          ul
            each p in productos.slice(0,20)
              li
                a(href=`/producto/${p.sku}`) #{p.nombre}
                |  (SKU: #{p.sku}) - $#{p.precio} | Stock: #{p.stock}
          small Mostrando 20 de #{productos.length} productos...
      if view=='producto' && producto
        h2= producto.nombre
        p SKU: #{producto.sku}
        p Precio: $#{producto.precio}
        p Stock: #{producto.stock}
        p Categoría: #{producto.categoria}
        form(action="/carrito" method="post")
          input(type="hidden" name="token" value=token)
          input(type="hidden" name="sku" value=producto.sku)
          label Cantidad:
            input(type="number" name="cantidad" min="1" value="1" required)
          button(type="submit") Agregar al carrito
      if view=='carrito' && carrito
        h2 Carrito de compras
        if carrito.items && carrito.items.length
          ul
            each item in carrito.items
              li #{item.nombre} x #{item.cantidad} - $#{item.precio}
          p Total: $#{carrito.total}
        else
          p El carrito está vacío.
        if carrito.message
          .result= carrito.message
